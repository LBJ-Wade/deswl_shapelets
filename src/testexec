#!/bin/bash

#root=decam--24--27-i-2_61
#stardat=stars1.dat
root=decam--24--37-i-14_06
#stardat=stars2.dat
#root=decam--25--30-i-3_51
#stardat=stars3.dat
#root=decam--25--38-i-12_01
#stardat=stars4.dat
#root=decam--25--38-i-8_01
#stardat=stars5.dat
#root=decam--27--31-i-2_16
#stardat=stars6.dat
#root=decam--27--9-i-3_20
#stardat=stars7.dat
config=../example_config/wl.config
#input=/home/mjarvis/des/wl/testdata/data
#output=/home/mjarvis/des/wl/testdata/output2
input=/Users/Mike/Astro/des/devel/wl/testdata/data
output=/Users/Mike/Astro/des/devel/wl/testdata/output2
#input=/u/ac/jarvis/wl/testdata/data
#output=/u/ac/jarvis/wl/testdata/output
#dc4=
#dc4='shear_dc4_input_format=true'
dc4='+dc4.config'
BINDIR=.
#BINDIR=/home/mjarvis/bin
#BINDIR=/Users/Mike/bin
vl=1

echo $BINDIR/findstars $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=fs.debug verbose=$vl output_dots=1 $dc4
time $BINDIR/findstars $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=fs.debug verbose=$vl output_dots=1 $dc4
#/bin/cp $output${root}_stars.dat $output$stardat
cp fs.debug $output

echo MeasurePSF:
echo $BINDIR/measurepsf $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=mp.debug verbose=$vl output_dots=1 $dc4
time $BINDIR/measurepsf $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=mp.debug verbose=$vl output_dots=1 $dc4
cp mp.debug $output

echo MeasureShear:
echo $BINDIR/measureshear $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=ms.debug verbose=$vl output_dots=1 $dc4
time $BINDIR/measureshear $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=ms.debug verbose=$vl output_dots=1 $dc4
cp ms.debug $output
exit

echo FullPipeline
echo $BINDIR/fullpipe $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=fp.debug verbose=$vl output_dots=1 $dc4
time $BINDIR/fullpipe $config root=$root input_prefix=$input/ output_prefix=$output/ debug_file=fp.debug verbose=$vl output_dots=1 $dc4

#echo Try execution with bad configfile:
#$BINDIR/findstars foo root=$root input_prefix=$input/ output_prefix=$output/
#$BINDIR/measurepsf foo root=$root input_prefix=$input/ output_prefix=$output/
#$BINDIR/measureshear foo root=$root input_prefix=$input/ output_prefix=$output/
#echo Try execution with bad imagename:
#$BINDIR/findstars $config stars_file=$(root)_stars.fits root=foo
#$BINDIR/measurepsf $config psf_file=$(root)_psf.fits root=foo
#$BINDIR/measureshear $config shear_file=$(root)_shear.fits root=foo
