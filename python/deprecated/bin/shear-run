#!/usr/bin/env python
"""
    %prog config_file

Description
    Run an image through the weak lensing code. The config file has a list
    of all input/output files and other parameters needed for the run.

        required:
            type - one of fullpipe,findstars,measurepsf,measureshear
            wl_config
            image
            cat
            stars
            fitpsf
            psf
            shear
            qa

        optional:
            serun
            debug_level
            output_dots
            output_info

    Note output_dots is turned off by default, unlike in the C++ code

    For examples, see the files generated by /bin/generate-se-wq
"""

import sys
import logging
import deswl

logging.basicConfig(level=logging.ERROR)

from optparse import OptionParser
parser = OptionParser(__doc__)

options, args = parser.parse_args(sys.argv[1:])

if len(args) < 1:
    parser.print_help()
    sys.exit(1)

config_file=args[0]

with open(config_file) as fobj:
    import yaml
    conf=yaml.load(fobj)

if 'output_dots' not in conf:
    conf['output_dots'] = False

ip=deswl.wlpipe.ImageProcessor(conf)
ip.run()
