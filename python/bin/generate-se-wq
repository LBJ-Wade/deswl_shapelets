#!/usr/bin/env python
"""
    %prog serun

Generate all the wq job files for the given serun.
"""

import sys
import deswl
from deswl.files import ShearFiles,SEWQJob
import desdb

from optparse import OptionParser
parser = OptionParser(__doc__)
parser.add_option("-g","--groups",default=None, help="groups for queue")
parser.add_option("--fs",default='nfs', help="file system, nfs or hdfs")

def main():

    options, args = parser.parse_args(sys.argv[1:])
    if len(args) < 1:
        parser.print_help()
        sys.exit(45)

    serun=args[0]

    rc=deswl.files.Runconfig(serun)
    rc.verify()
    sfobj=ShearFiles(serun, fs=options.fs)
    all_files=sfobj.get_flist()
    nf=len(all_files)

    for i,fdict in enumerate(all_files):
        if ((i+1) % 1000) == 0:
            verbose=True
            print '%d/%d' % (i+1,nf)
        else:
            verbose=False
        fdict['output_dots'] = False
        sj=SEWQJob(serun,files=fdict,groups=options.groups,verbose=verbose)
        sj.write_config()
        sj.write_job_file()


main()

